FROM node:18-alpine

# Instalar dependências do sistema
RUN apk add --no-cache \
    bash \
    git \
    # python3 \
    py3-pip \
    py3-virtualenv \
    make \
    g++ \
    libc6-compat \
    linux-headers \
    postgresql-client

# Instalar Truffle e Ganache
RUN npm install -g truffle@5.8.2 ganache-cli

# Definir diretório de trabalho
WORKDIR /usr/src

# Copiar o restante dos arquivos
COPY . .

# Dar permissão de execução ao script de entrypoint
RUN chmod +x /usr/src/entrypoint.sh /usr/src/heathcheck.sh

# # Criar o ambiente virtual
# RUN python3 -m venv /usr/src/venv

# # Garantir que o diretório venv tenha as permissões corretas
# RUN chmod -R 755 /usr/src/venv

# Ativar o ambiente virtual e instalar dependências
RUN /usr/src/venv/bin/pip install -r requirements.txt

# Expor a porta do Ganache
EXPOSE 8545

# Definir o entrypoint
CMD ["sh", "/usr/src/entrypoint.sh"]